<html lang="en"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
    window.__firebase_config = firebaseConfig;
    window.__initial_auth_token = initialAuthToken;
    window.__app_id = appId;
        })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImIxZjQyNzYzZjkzNGExOTQwMWNkOTFhNjdjY2FhNzdiNjIwNWU2N2EiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwMTI5NTYxNjk5Njg0NDg5ODMxMSIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJlYjdjZTcwYWI2YzgtaW5kZXguaHRtbC03NzgifSwiZXhwIjoxNzcwMTI3NzA2LCJpYXQiOjE3NzAxMjQxMDYsImFsZyI6IlJTMjU2In0.LlBIQgA11XUfeLt2iZ8hRIU-MwsrbZatM87vvycNzbVFhuexk7Limi-DARUAtN49dPUY42SAfox9EHACE9eBtb6kUlFagt_fBtap2Mn-JaIYJndjrTKYD4-tpLB-U1UxXNlar0gSBUsTZFoBg-U1yu_QRNNLkR9Zk4oKAw7QG3sESXAkDbIcRlYwbQVhlp6Sz79mtY7lvAsG3lU9k9FECGx7HPjQX4O9GgK_kNOMdrp1msSj0SxPgZoOE53m71eD8tDUztfn0iaqUQMdLj6oNihJDnEW_uHMWUN7XlMf7tam5zqJf_hqqn_sXup9nRVNtMPW7inXdYQHg6EOmrxCkA","eb7ce70ab6c8-index.html-778")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

MIT License

Copyright (c) 2017-2023 W.Y.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
</script><script>(function() {
// Ensure this script is executed only once
if (window.firebaseAuthBridgeScriptLoaded) {
return;
}
window.firebaseAuthBridgeScriptLoaded = true;

let nextTokenPromiseId = 0;

// Stores { resolve, reject } for ongoing token requests
const pendingTokenPromises = {};

// Listen for messages from the Host Application
window.addEventListener('message', function(event) {

const messageData = event.data;

if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
  const { success, token, error, promiseId } = messageData ?? {};
  if (pendingTokenPromises[promiseId]) {
    if (success) {
      pendingTokenPromises[promiseId].resolve(token);
    } else {
      pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
    }
    delete pendingTokenPromises[promiseId];
  }
}
});

// Expose a function for the Generated App to request a new Firebase token
window.requestNewFirebaseToken = function() {
const currentPromiseId = nextTokenPromiseId++;
const promise = new Promise((resolve, reject) => {
  pendingTokenPromises[currentPromiseId] = { resolve, reject };
});
if (window.parent && window.parent !== window) {
  window.parent.postMessage({
    type: 'REQUEST_NEW_FIREBASE_TOKEN',
    promiseId: currentPromiseId
  }, '*');
} else {
  pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
  delete pendingTokenPromises[currentPromiseId];
}
return promise;
};
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
try {
  Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
    get: function() {
      return undefined; // Or throw an error
    },
    configurable: false
  });
} catch (error) {
  console.error("Error defining prototype getter:", error);
}
}
})();

(function() {
const pendingMediaResolvers = {};
let nextMediaPromiseId = 0;

function requestMediaPermissions(constraints) {
const mediaPromiseId = nextMediaPromiseId++;
const promise = new Promise((resolve, reject) => {
  pendingMediaResolvers[mediaPromiseId] = (granted) => {
    delete pendingMediaResolvers[mediaPromiseId];
    resolve(granted);
  };
});

window.parent.postMessage({
  type: 'requestMediaPermission',
  constraints: constraints,
  promiseId: mediaPromiseId,
}, '*');

return promise;
}

let originalGetUserMedia = realOriginalGetUserMedia;

function interceptGetUserMedia() {
if (navigator.mediaDevices) {
  Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
    value: function(constraints) {
      return requestMediaPermissions(constraints).then((granted) => {
        if (granted) {
          if (originalGetUserMedia) {
            return originalGetUserMedia(constraints);
          } else {
            throw new Error("Original getUserMedia not available.");
          }
        } else {
          throw new DOMException('Permission denied', 'NotAllowedError');
        }
      });
    },
    writable: false,
    configurable: false
  });
}
}

interceptGetUserMedia();

const observer = new MutationObserver(function(mutationsList, observer) {
for (const mutation of mutationsList) {
  if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
    interceptGetUserMedia();
  } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
    interceptGetUserMedia();
  } else if (mutation.type === 'childList' && mutation.addedNodes) {
    mutation.addedNodes.forEach(node => {
      if (node === navigator.mediaDevices) {
        interceptGetUserMedia();
      }
    });
  }
}
});

function interceptSpeechRecognition() {
if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
  return;
}

const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

const SpeechRecognitionWrapper = function(...args) {
  const recognizer = new OriginalSpeechRecognition(...args);
  const originalStart = recognizer.start.bind(recognizer);

  recognizer.start = function() {
    requestMediaPermissions({ audio: true }).then(granted => {
      if (granted) {
        originalStart();
      } else {
        const errorEvent = new SpeechRecognitionErrorEvent('error');
        errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
        recognizer.dispatchEvent(errorEvent);
      }
    });
  };

  return recognizer;
};

SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

if (window.SpeechRecognition) {
  window.SpeechRecognition = SpeechRecognitionWrapper;
}
if (window.webkitSpeechRecognition) {
  window.webkitSpeechRecognition = SpeechRecognitionWrapper;
}
}

interceptSpeechRecognition();

window.addEventListener('message', function(event) {
if (event.data) {
  if (event.data.type === 'resolveMediaPermission') {
    const { promiseId, granted } = event.data;
    if (pendingMediaResolvers[promiseId]) {
      pendingMediaResolvers[promiseId](granted);
    }
  }
}
});

})();</script><script>((function(modelInformation) {
const originalFetch = window.fetch;
// TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
let googleLlmBaseApiUrls = [
'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageTransformModelName + ':generateContent',
'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
];
modelInformation.deprecatedTextModelNames.forEach((modelName) => {
googleLlmBaseApiUrls.push(
  'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
  'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
);
});
modelInformation.deprecatedImageModelNames.forEach((modelName) => {
googleLlmBaseApiUrls.push(
  'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
  'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
);
});

const pendingFetchResolvers = {};
let nextPromiseId = 0;

function handleStringInput(input, optionsArgument) {
const actualUrl = input;
const fetchCallArgs = [actualUrl, optionsArgument];
const effectiveOptions = optionsArgument || {};
const bodyForApiKeyCheck = effectiveOptions.body;
const bodyForPostMessage = effectiveOptions.body;
return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
}

function handleRequestInput(input, optionsArgument) {
const actualUrl = input.url;
const fetchCallArgs = [input, optionsArgument];
const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
let bodyForApiKeyCheck;
let bodyForPostMessage;

if (optionsArgument) {
  if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
  if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
  if ('body' in optionsArgument) {
    bodyForApiKeyCheck = optionsArgument.body;
    bodyForPostMessage = optionsArgument.body;
  } else {
    bodyForApiKeyCheck = undefined;
    bodyForPostMessage = input.body;
  }
} else {
  bodyForApiKeyCheck = undefined;
  bodyForPostMessage = input.body;
}
return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
}

window.fetch = function(input, optionsArgument) {
let actualUrl;
let fetchCallArgs;
let effectiveOptions = {};
let bodyForApiKeyCheck;
let bodyForPostMessage;

if (typeof input === 'string') {
  ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
} else if (input instanceof Request) {
  ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
} else {
  return originalFetch.apply(window, [input, optionsArgument]);
}

effectiveOptions.method = effectiveOptions.method || 'GET';
if (!effectiveOptions.headers) {
  effectiveOptions.headers = new Headers();
}


if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
  let apiKeyIsNull = true;

  const regex = new RegExp("models/([^:]+)");
  const modelNameMatch = actualUrl.match(regex);
  const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


  try {
    const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
    const apiKeyParam = urlObject.searchParams.get('key');
    if (apiKeyParam) {
      apiKeyIsNull = false;
    }
  } catch (e) {
    // Continue checks even if URL parsing fails
  }

  if (apiKeyIsNull && effectiveOptions.headers) {
    const h = new Headers(effectiveOptions.headers);
    const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
    if (apiKeyHeaderValue) {
      apiKeyIsNull = false;
      return originalFetch.apply(window, fetchCallArgs);
    }
  }

  if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
    try {
      const bodyData = JSON.parse(bodyForApiKeyCheck);
      if (bodyData && bodyData.apiKey) {
        apiKeyIsNull = false;
        return originalFetch.apply(window, fetchCallArgs);
      }
    } catch (e) {
      // Ignore JSON parsing errors
    }
  }

  if(apiKeyIsNull) {
    const promiseId = nextPromiseId++;
    const promise = new Promise((resolve) => {
      pendingFetchResolvers[promiseId] = (resolvedResponse) => {
        delete pendingFetchResolvers[promiseId];
        resolve(resolvedResponse);
      };
    });

    let serializedBodyForPostMessage;
    if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
        serializedBodyForPostMessage = bodyForPostMessage;
    } else if (bodyForPostMessage instanceof ReadableStream) {
        serializedBodyForPostMessage = null;
    } else {
        try {
            serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
        } catch (e) {
            serializedBodyForPostMessage = null;
        }
    }

    const messageOptions = {
        method: effectiveOptions.method,
        headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
        body: serializedBodyForPostMessage
    };

    window.parent.postMessage({
      type: 'requestFetch',
      url: actualUrl,
      modelName: modelName,
      options: messageOptions,
      promiseId: promiseId,
    }, '*');

    return promise;
  }
  return originalFetch.apply(window, fetchCallArgs);
}
return originalFetch.apply(window, fetchCallArgs);
};

window.addEventListener('message', function(event) {
if (event.data && event.data.type === 'resolveFetch') {
  const { promiseId, response } = event.data;
  if (pendingFetchResolvers[promiseId]) {
    try {
      const reconstructedResponse = new Response(response.body, {
        status: response.status,
        statusText: response.statusText,
        headers: new Headers(response.headers),
      });
      pendingFetchResolvers[promiseId](reconstructedResponse);
    } catch (error) {
      pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
    }
  }
}
});

}))({"textModelName":"gemini-2.5-flash-preview-09-2025","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","imageTransformModelName":"gemini-3-pro-image-preview-11-2025","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function() {
const originalConsoleLog = console.log;
const originalConsoleError = console.error;

/**
* Normalizes an error event or a promise rejection reason into a structured error object.
* @param {*} errorEventOrReason The error object or reason.
* @return {object} Structured error data { message, name, stack }.
*/
function getErrorObject(errorEventOrReason) {
if (errorEventOrReason instanceof Error) {
  return {
    message: errorEventOrReason.message,
    name: errorEventOrReason.name,
    stack: errorEventOrReason.stack,
  };
}
// Fallback for non-Error objects.
try {
  return {
    message: JSON.stringify(errorEventOrReason),
    name: 'UnknownErrorType',
    stack: null,
  };
} catch (e) {
  return {
    message: String(errorEventOrReason),
    name: 'UnknownErrorTypeNonStringifiable',
    stack: null,
  };
}
}

/**
* Converts an array of arguments (from log/error) into a single string.
* Handles Error objects specially to include their message and stack.
* @param {Array<*>} args - Arguments passed to console methods.
* @return {string} A string representation of the arguments.
*/
function stringifyArgs(args) {
return args
  .map((arg) => {
    if (arg instanceof Error) {
      const {message, stack} = arg;
      return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
    }
    if (typeof arg === 'object' && arg !== null) {
      try {
        return JSON.stringify(arg);
      } catch (error) {
        return '[Circular Object]';
      }
    } else {
      return String(arg);
    }
  })
  .join(' ');
}

console.log = function(...args) {
const logString = stringifyArgs(args);
window.parent.postMessage({ type: 'log', message: logString }, '*');
originalConsoleLog.apply(console, args);
};

console.error = function(...args) {
let errorData;
if (args.length > 0 && args[0] instanceof Error) {
  const err = args[0];
  // If the first arg is an Error, capture its details.
  errorData = {
    type: 'error',
    source: 'CONSOLE_ERROR',
    ...getErrorObject(err),
    rawArgsString: stringifyArgs(args.slice(1)),
    timestamp: new Date().toISOString(),
  };
} else {
  // If not an Error object, treat all args as a general error message.
  errorData = {
    type: 'error',
    source: 'CONSOLE_ERROR',
    message: stringifyArgs(args),
    name: 'ConsoleLoggedError',
    stack: null,
    timestamp: new Date().toISOString(),
  };
}
window.parent.postMessage(errorData, '*');
originalConsoleError.apply(console, args);
};

// Listen for global unhandled synchronous errors.
window.addEventListener('error', function(event) {
const errorDetails = event.error ? getErrorObject(event.error) : {
  message: event.message,
  name: 'GlobalError',
  stack: null,
  filename: event.filename,
  lineno: event.lineno,
  colno: event.colno,
};

window.parent.postMessage({
  type: 'error',
  source: 'global',
  ...errorDetails,
  message: errorDetails.message || event.message,
  timestamp: new Date().toISOString(),
}, '*');
});

// Listen for unhandled promise rejections (asynchronous errors).
window.addEventListener('unhandledrejection', function(event) {
const errorDetails = getErrorObject(event.reason);

window.parent.postMessage({
  type: 'error',
  source: 'unhandledrejection',
  ...errorDetails,
  message: errorDetails.message || 'Unhandled Promise Rejection',
  timestamp: new Date().toISOString(),
}, '*');
});

})();</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Code Lens: RAG Configuration Walkthrough</title>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Google Fonts: Inter & Fira Code -->
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&amp;family=Inter:wght@300;400;600;700&amp;display=swap" rel="stylesheet">
<!-- Prism.js for Syntax Highlighting -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js" crossorigin="anonymous"></script>

<style>
    :root {
        --bg-soft: #f4f7fb;
        --code-bg: #0d1117;
        --code-accent: #161b22;
        --indigo-600: #6366f1;
    }

    body {
        font-family: 'Inter', sans-serif;
        background-color: var(--bg-soft);
        color: #1f2937;
        overflow: hidden; /* Handled by internal panels */
    }

    .font-mono {
        font-family: 'Fira Code', monospace;
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
        width: 6px;
    }
    ::-webkit-scrollbar-track {
        background: transparent;
    }
    ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
    }

    /* Prism Customization (GitHub Dark Style) */
    pre[class*="language-"] {
        background: transparent !important;
        margin: 0 !important;
        padding: 0 !important;
        font-size: 0.9rem;
        line-height: 1.6;
    }
    .token.keyword { color: #ff7b72; }
    .token.string { color: #a5d6ff; }
    .token.function { color: #d2a8ff; }
    .token.comment { color: #8b949e; }
    .token.attr-name { color: #79c0ff; }

    /* Lens Effect */
    .code-line {
        transition: opacity 0.3s ease, border-color 0.3s ease;
        border-left: 3px solid transparent;
        padding-left: 1rem;
    }
    .code-line.active {
        opacity: 1 !important;
        border-left-color: var(--indigo-600);
        background: rgba(99, 102, 241, 0.05);
    }
    .code-line.dimmed {
        opacity: 0.25;
    }

    /* Glassmorphism Header */
    .glass-header {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(226, 232, 240, 0.8);
    }

    /* Layout Panels */
    .main-container {
        display: grid;
        grid-template-columns: 40% 60%;
        height: calc(100vh - 64px);
    }

    @media (max-width: 1024px) {
        .main-container {
            grid-template-columns: 1fr;
            overflow-y: auto;
        }
        .panel-left, .panel-right { height: auto !important; overflow: visible !important; }
    }

    .explanation-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
    }
    .explanation-card.active {
        box-shadow: 0 0 0 2px var(--indigo-600);
        background: #ffffff;
    }

    /* OS Dots */
    .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; }
    .dot-red { background: #ff5f56; }
    .dot-amber { background: #ffbd2e; }
    .dot-green { background: #27c93f; }

    #progress-bar {
        height: 3px;
        background: var(--indigo-600);
        width: 0%;
        transition: width 0.4s ease;
    }
</style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.relative{position:relative}.sticky{position:sticky}.top-0{top:0px}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.ml-2{margin-left:0.5rem}.mt-6{margin-top:1.5rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.flex{display:flex}.hidden{display:none}.h-1\.5{height:0.375rem}.h-16{height:4rem}.h-24{height:6rem}.h-5{height:1.25rem}.h-full{height:100%}.h-6{height:1.5rem}.min-h-\[300px\]{min-height:300px}.w-0{width:0px}.w-48{width:12rem}.w-5{width:1.25rem}.w-full{width:100%}.w-12{width:3rem}.w-6{width:1.5rem}.max-w-2xl{max-width:42rem}.max-w-xl{max-width:36rem}.flex-1{flex:1 1 0%}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.select-none{-webkit-user-select:none;user-select:none}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-6{gap:1.5rem}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.whitespace-pre{white-space:pre}.rounded-3xl{border-radius:1.5rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-slate-800{--tw-border-opacity:1;border-color:rgb(30 41 59 / var(--tw-border-opacity, 1))}.border-slate-100{--tw-border-opacity:1;border-color:rgb(241 245 249 / var(--tw-border-opacity, 1))}.bg-\[\#0d1117\]{--tw-bg-opacity:1;background-color:rgb(13 17 23 / var(--tw-bg-opacity, 1))}.bg-\[\#161b22\]{--tw-bg-opacity:1;background-color:rgb(22 27 34 / var(--tw-bg-opacity, 1))}.bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.bg-slate-200{--tw-bg-opacity:1;background-color:rgb(226 232 240 / var(--tw-bg-opacity, 1))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.p-2{padding:0.5rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-8{padding-left:2rem;padding-right:2rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.pr-4{padding-right:1rem}.pt-1{padding-top:0.25rem}.text-right{text-align:right}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xs{font-size:0.75rem;line-height:1rem}.text-\[10px\]{font-size:10px}.text-lg{font-size:1.125rem;line-height:1.75rem}.font-bold{font-weight:700}.font-light{font-weight:300}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.leading-relaxed{line-height:1.625}.tracking-tight{letter-spacing:-0.025em}.tracking-widest{letter-spacing:0.1em}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184 / var(--tw-text-opacity, 1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-slate-800{--tw-text-opacity:1;color:rgb(30 41 59 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-indigo-500{--tw-text-opacity:1;color:rgb(99 102 241 / var(--tw-text-opacity, 1))}.text-slate-300{--tw-text-opacity:1;color:rgb(203 213 225 / var(--tw-text-opacity, 1))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105 / var(--tw-text-opacity, 1))}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-500{transition-duration:500ms}.hover\:bg-slate-200:hover{--tw-bg-opacity:1;background-color:rgb(226 232 240 / var(--tw-bg-opacity, 1))}.hover\:shadow-md:hover{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.group:hover .group-hover\:bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.group:hover .group-hover\:text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}@media (min-width: 768px){.md\:flex{display:flex}.md\:p-10{padding:2.5rem}}</style></head>
<body class="antialiased">

<!-- Header -->
<header class="glass-header sticky top-0 z-50 h-16 flex items-center px-8 justify-between">
    <div class="flex items-center gap-3">
        <div class="bg-indigo-600 p-2 rounded-lg">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        </div>
        <h1 class="font-bold text-slate-800 tracking-tight">CodeLens <span class="font-light text-slate-500 ml-2">RAG Architecture</span></h1>
    </div>
    <div class="hidden md:flex items-center gap-6">
        <div class="text-xs font-semibold text-slate-400 uppercase tracking-widest">Walkthrough Progress</div>
        <div class="w-48 bg-slate-200 rounded-full h-1.5 overflow-hidden">
            <div id="progress-bar-inner" class="bg-indigo-600 h-full w-0 transition-all duration-500" style="width: 28.5714%;"></div>
        </div>
    </div>
    <button id="view-mode-toggle" class="px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-xl text-sm font-semibold transition-all">
        Switch to Full Code
    </button>
</header>

<div id="progress-bar" style="width: 28.5714%;"></div>

<main class="main-container">
    <!-- Left Panel: Explanations -->
    <section class="panel-left overflow-y-auto p-6 md:p-10 space-y-6">
        <div id="explanation-container" class="space-y-6 max-w-xl mx-auto">
            <div class="explanation-card bg-white p-6 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition-all group" data-id="1" onclick="setActive(1)">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-[10px] font-bold tracking-widest text-indigo-500 uppercase">Re-ranking Model Load</span>
                    <span class="h-6 w-6 rounded-full bg-slate-50 flex items-center justify-center text-xs text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-colors">1</span>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-2">Re-ranking Model Selection</h3>
                <p class="text-slate-600 leading-relaxed text-sm">This block defines the external re-ranking model used in the RAG pipeline. By explicitly configuring COHERE_RERANKER, the system opts for a cross-encoder style re-ranker that evaluates queryâ€“document pairs jointly.</p>
            </div>
        
            <div class="explanation-card bg-white p-6 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition-all group active" data-id="2" onclick="setActive(2)">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-[10px] font-bold tracking-widest text-indigo-500 uppercase">Candidate Selection</span>
                    <span class="h-6 w-6 rounded-full bg-slate-50 flex items-center justify-center text-xs text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-colors">2</span>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-2">Candidate Pool Size</h3>
                <p class="text-slate-600 leading-relaxed text-sm">These configurations control how many candidates are passed from the retriever stage. They define the breadth of recall before re-ranking.</p>
            </div>
        
            <div class="explanation-card bg-white p-6 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition-all group" data-id="3" onclick="setActive(3)">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-[10px] font-bold tracking-widest text-indigo-500 uppercase">Ranking Strategy</span>
                    <span class="h-6 w-6 rounded-full bg-slate-50 flex items-center justify-center text-xs text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-colors">3</span>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-2">Re-ranked Output Truncation</h3>
                <p class="text-slate-600 leading-relaxed text-sm">These parameters define how many documents survive after re-ranking scores are applied. This caps the final ranked list sent to the generator.</p>
            </div>
        
            <div class="explanation-card bg-white p-6 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition-all group" data-id="4" onclick="setActive(4)">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-[10px] font-bold tracking-widest text-indigo-500 uppercase">Candidate Filtering</span>
                    <span class="h-6 w-6 rounded-full bg-slate-50 flex items-center justify-center text-xs text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-colors">4</span>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-2">Similarity Cutoff</h3>
                <p class="text-slate-600 leading-relaxed text-sm">Acts as a coarse pre-filter. Removes clearly irrelevant chunks early, reducing the load on the re-ranker and optimizing latency.</p>
            </div>
        
            <div class="explanation-card bg-white p-6 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition-all group" data-id="5" onclick="setActive(5)">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-[10px] font-bold tracking-widest text-indigo-500 uppercase">Input Composition</span>
                    <span class="h-6 w-6 rounded-full bg-slate-50 flex items-center justify-center text-xs text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-colors">5</span>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-2">Hybrid Retrieval Fusion</h3>
                <p class="text-slate-600 leading-relaxed text-sm">Enables sparseâ€“dense fusion. The re-ranker receives candidates from both semantic embeddings and lexical (BM42) signals.</p>
            </div>
        
            <div class="explanation-card bg-white p-6 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition-all group" data-id="6" onclick="setActive(6)">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-[10px] font-bold tracking-widest text-indigo-500 uppercase">Granularity</span>
                    <span class="h-6 w-6 rounded-full bg-slate-50 flex items-center justify-center text-xs text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-colors">6</span>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-2">Chunking Granularity</h3>
                <p class="text-slate-600 leading-relaxed text-sm">Size and overlap determine the semantic density. Smaller chunks improve precision but increase retrieval count.</p>
            </div>
        
            <div class="explanation-card bg-white p-6 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition-all group" data-id="7" onclick="setActive(7)">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-[10px] font-bold tracking-widest text-indigo-500 uppercase">Production Constraints</span>
                    <span class="h-6 w-6 rounded-full bg-slate-50 flex items-center justify-center text-xs text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-colors">7</span>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-2">Streaming Interaction</h3>
                <p class="text-slate-600 leading-relaxed text-sm">Influences when results become visible. In streaming mode, re-ranking must finish before token emission begins.</p>
            </div>
        </div>
        <div class="h-24"></div> <!-- Spacer -->
    </section>

    <!-- Right Panel: Code Pane -->
    <section class="panel-right bg-[#0d1117] relative overflow-hidden flex flex-col">
        <!-- Focused Snippet Mode (Hidden by default or toggled) -->
        <div id="snippet-mode" class="flex-1 flex flex-col items-center justify-center p-8 transition-all duration-500">
            <div class="w-full max-w-2xl bg-[#161b22] rounded-3xl overflow-hidden shadow-2xl border border-slate-800">
                <div class="px-5 py-3 border-b border-slate-800 flex items-center justify-between">
                    <div class="flex gap-2">
                        <span class="dot dot-red"></span>
                        <span class="dot dot-amber"></span>
                        <span class="dot dot-green"></span>
                    </div>
                    <span id="snippet-label" class="text-xs text-slate-500 font-mono">Candidate Selection</span>
                </div>
                <div class="p-6 overflow-x-auto min-h-[300px]">
                    <pre id="snippet-content" class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">RAG_SIMILARITY_TOP_K</span><span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token key atrule">RAG_SIMILARITY_TOP_K_REPORT</span><span class="token punctuation">:</span> <span class="token number">20</span></code></pre>
                </div>
            </div>
            <p class="mt-6 text-slate-500 text-sm animate-pulse">Select a block on the left to inspect logic.</p>
        </div>

        <!-- Full Code Mode (Active by default based on spec) -->
        <div id="full-mode" class="hidden flex-1 overflow-y-auto font-mono text-sm">
            <div id="full-code-container" class="py-10">
                <div id="L1" class="code-line flex group dimmed" data-line="1">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">1</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">HF_EMBED</span><span class="token punctuation">:</span> mixedbread<span class="token punctuation">-</span>ai/mxbai<span class="token punctuation">-</span>embed<span class="token punctuation">-</span>large<span class="token punctuation">-</span>v1</div>
                </div>
            
                <div id="L2" class="code-line flex group dimmed" data-line="2">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">2</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">COHERE_RERANKER</span><span class="token punctuation">:</span> rerank<span class="token punctuation">-</span>v3.5</div>
                </div>
            
                <div id="L3" class="code-line flex group dimmed" data-line="3">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">3</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">LLM_MODEL_TYPE</span><span class="token punctuation">:</span> OPENROUTER</div>
                </div>
            
                <div id="L4" class="code-line flex group dimmed" data-line="4">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">4</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">PROMPT_DIR</span><span class="token punctuation">:</span> prompts</div>
                </div>
            
                <div id="L5" class="code-line flex group dimmed" data-line="5">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">5</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"> </div>
                </div>
            
                <div id="L6" class="code-line flex group dimmed" data-line="6">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">6</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token comment"># Local Storage Configuration</span></div>
                </div>
            
                <div id="L7" class="code-line flex group dimmed" data-line="7">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">7</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">LOCAL_PERSIST_DIR</span><span class="token punctuation">:</span> data/persist</div>
                </div>
            
                <div id="L8" class="code-line flex group dimmed" data-line="8">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">8</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">LOCAL_TEMP_DIR</span><span class="token punctuation">:</span> data/temp</div>
                </div>
            
                <div id="L9" class="code-line flex group dimmed" data-line="9">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">9</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">LOCAL_CHAT_HISTORY_DIR</span><span class="token punctuation">:</span> ../data/chat_history</div>
                </div>
            
                <div id="L10" class="code-line flex group dimmed" data-line="10">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">10</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"> </div>
                </div>
            
                <div id="L11" class="code-line flex group dimmed" data-line="11">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">11</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">OPENAI<span class="token punctuation">:</span></div>
                </div>
            
                <div id="L12" class="code-line flex group dimmed" data-line="12">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">12</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">  REPORT<span class="token punctuation">:</span></div>
                </div>
            
                <div id="L13" class="code-line flex group dimmed" data-line="13">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">13</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">MODEL_NAME</span><span class="token punctuation">:</span> gpt<span class="token punctuation">-</span><span class="token number">4</span></div>
                </div>
            
                <div id="L14" class="code-line flex group dimmed" data-line="14">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">14</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">MAX_TOKENS</span><span class="token punctuation">:</span> <span class="token number">4096</span></div>
                </div>
            
                <div id="L15" class="code-line flex group dimmed" data-line="15">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">15</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">TEMPERATURE</span><span class="token punctuation">:</span> <span class="token number">0.7</span></div>
                </div>
            
                <div id="L16" class="code-line flex group dimmed" data-line="16">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">16</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">TOP_P</span><span class="token punctuation">:</span> <span class="token number">0.8</span></div>
                </div>
            
                <div id="L17" class="code-line flex group dimmed" data-line="17">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">17</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">REQUEST_TIMEOUT</span><span class="token punctuation">:</span> <span class="token number">180.0</span></div>
                </div>
            
                <div id="L18" class="code-line flex group dimmed" data-line="18">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">18</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">CONTEXT_WINDOW</span><span class="token punctuation">:</span> <span class="token number">8192</span></div>
                </div>
            
                <div id="L19" class="code-line flex group dimmed" data-line="19">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">19</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">  CHAT<span class="token punctuation">:</span></div>
                </div>
            
                <div id="L20" class="code-line flex group dimmed" data-line="20">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">20</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">MODEL_NAME</span><span class="token punctuation">:</span> gpt<span class="token punctuation">-</span><span class="token number">4</span></div>
                </div>
            
                <div id="L21" class="code-line flex group dimmed" data-line="21">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">21</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">MAX_TOKENS</span><span class="token punctuation">:</span> <span class="token number">1024</span></div>
                </div>
            
                <div id="L22" class="code-line flex group dimmed" data-line="22">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">22</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">TEMPERATURE</span><span class="token punctuation">:</span> <span class="token number">0.5</span></div>
                </div>
            
                <div id="L23" class="code-line flex group dimmed" data-line="23">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">23</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">TOP_P</span><span class="token punctuation">:</span> <span class="token number">0.7</span></div>
                </div>
            
                <div id="L24" class="code-line flex group dimmed" data-line="24">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">24</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">REQUEST_TIMEOUT</span><span class="token punctuation">:</span> <span class="token number">180.0</span></div>
                </div>
            
                <div id="L25" class="code-line flex group dimmed" data-line="25">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">25</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">CONTEXT_WINDOW</span><span class="token punctuation">:</span> <span class="token number">8192</span></div>
                </div>
            
                <div id="L26" class="code-line flex group dimmed" data-line="26">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">26</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"> </div>
                </div>
            
                <div id="L27" class="code-line flex group dimmed" data-line="27">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">27</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">OPENROUTER<span class="token punctuation">:</span></div>
                </div>
            
                <div id="L28" class="code-line flex group dimmed" data-line="28">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">28</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">  REPORT<span class="token punctuation">:</span></div>
                </div>
            
                <div id="L29" class="code-line flex group dimmed" data-line="29">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">29</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">MODEL_NAME</span><span class="token punctuation">:</span> meta<span class="token punctuation">-</span>llama/llama<span class="token punctuation">-</span>3<span class="token punctuation">-</span>70b<span class="token punctuation">-</span>instruct</div>
                </div>
            
                <div id="L30" class="code-line flex group dimmed" data-line="30">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">30</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">MAX_TOKENS</span><span class="token punctuation">:</span> <span class="token number">4096</span></div>
                </div>
            
                <div id="L31" class="code-line flex group dimmed" data-line="31">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">31</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">TEMPERATURE</span><span class="token punctuation">:</span> <span class="token number">0.3</span></div>
                </div>
            
                <div id="L32" class="code-line flex group dimmed" data-line="32">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">32</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">TOP_P</span><span class="token punctuation">:</span> <span class="token number">0.7</span></div>
                </div>
            
                <div id="L33" class="code-line flex group dimmed" data-line="33">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">33</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">REQUEST_TIMEOUT</span><span class="token punctuation">:</span> <span class="token number">180.0</span></div>
                </div>
            
                <div id="L34" class="code-line flex group dimmed" data-line="34">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">34</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">CONTEXT_WINDOW</span><span class="token punctuation">:</span> <span class="token number">8192</span></div>
                </div>
            
                <div id="L35" class="code-line flex group dimmed" data-line="35">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">35</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">  CHAT<span class="token punctuation">:</span></div>
                </div>
            
                <div id="L36" class="code-line flex group dimmed" data-line="36">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">36</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">MODEL_NAME</span><span class="token punctuation">:</span> meta<span class="token punctuation">-</span>llama/llama<span class="token punctuation">-</span>3<span class="token punctuation">-</span>70b<span class="token punctuation">-</span>instruct</div>
                </div>
            
                <div id="L37" class="code-line flex group dimmed" data-line="37">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">37</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">MAX_TOKENS</span><span class="token punctuation">:</span> <span class="token number">2048</span></div>
                </div>
            
                <div id="L38" class="code-line flex group dimmed" data-line="38">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">38</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">TEMPERATURE</span><span class="token punctuation">:</span> <span class="token number">0.6</span></div>
                </div>
            
                <div id="L39" class="code-line flex group dimmed" data-line="39">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">39</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">TOP_P</span><span class="token punctuation">:</span> <span class="token number">0.7</span></div>
                </div>
            
                <div id="L40" class="code-line flex group dimmed" data-line="40">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">40</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">REQUEST_TIMEOUT</span><span class="token punctuation">:</span> <span class="token number">180.0</span></div>
                </div>
            
                <div id="L41" class="code-line flex group dimmed" data-line="41">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">41</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">CONTEXT_WINDOW</span><span class="token punctuation">:</span> <span class="token number">8192</span></div>
                </div>
            
                <div id="L42" class="code-line flex group dimmed" data-line="42">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">42</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"> </div>
                </div>
            
                <div id="L43" class="code-line flex group dimmed" data-line="43">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">43</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">OLLAMA<span class="token punctuation">:</span></div>
                </div>
            
                <div id="L44" class="code-line flex group dimmed" data-line="44">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">44</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">  REPORT<span class="token punctuation">:</span></div>
                </div>
            
                <div id="L45" class="code-line flex group dimmed" data-line="45">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">45</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">MODEL_NAME</span><span class="token punctuation">:</span> llama3.1<span class="token punctuation">:</span>8b</div>
                </div>
            
                <div id="L46" class="code-line flex group dimmed" data-line="46">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">46</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">CTX_LENGTH</span><span class="token punctuation">:</span> <span class="token number">32768</span></div>
                </div>
            
                <div id="L47" class="code-line flex group dimmed" data-line="47">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">47</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">PREDICT_LENGTH</span><span class="token punctuation">:</span> <span class="token number">4096</span></div>
                </div>
            
                <div id="L48" class="code-line flex group dimmed" data-line="48">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">48</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"> </div>
                </div>
            
                <div id="L49" class="code-line flex group dimmed" data-line="49">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">49</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">ANTHROPIC<span class="token punctuation">:</span></div>
                </div>
            
                <div id="L50" class="code-line flex group dimmed" data-line="50">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">50</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">  REPORT<span class="token punctuation">:</span></div>
                </div>
            
                <div id="L51" class="code-line flex group dimmed" data-line="51">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">51</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">MODEL_NAME</span><span class="token punctuation">:</span> claude<span class="token punctuation">-</span>3<span class="token punctuation">-</span>opus<span class="token punctuation">-</span>latest</div>
                </div>
            
                <div id="L52" class="code-line flex group dimmed" data-line="52">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">52</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">CTX_LENGTH</span><span class="token punctuation">:</span> <span class="token number">32768</span></div>
                </div>
            
                <div id="L53" class="code-line flex group dimmed" data-line="53">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">53</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">    <span class="token key atrule">PREDICT_LENGTH</span><span class="token punctuation">:</span> <span class="token number">4096</span></div>
                </div>
            
                <div id="L54" class="code-line flex group dimmed" data-line="54">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">54</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"> </div>
                </div>
            
                <div id="L55" class="code-line flex group dimmed" data-line="55">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">55</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">PDF_BASE_URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//rag<span class="token punctuation">-</span>llm.s3.us<span class="token punctuation">-</span>east<span class="token punctuation">-</span>2.amazonaws.com/</div>
                </div>
            
                <div id="L56" class="code-line flex group dimmed" data-line="56">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">56</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">S3_LOGS_BUCKET</span><span class="token punctuation">:</span> altgan<span class="token punctuation">-</span>logs</div>
                </div>
            
                <div id="L57" class="code-line flex group dimmed" data-line="57">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">57</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">S3_CHAT_HISTORY</span><span class="token punctuation">:</span> chat_logs</div>
                </div>
            
                <div id="L58" class="code-line flex group dimmed" data-line="58">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">58</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">S3_PERSIST_BUCKET</span><span class="token punctuation">:</span> altgan<span class="token punctuation">-</span>persist</div>
                </div>
            
                <div id="L59" class="code-line flex group dimmed" data-line="59">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">59</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">S3_PERSIST_DIR</span><span class="token punctuation">:</span> /home/ubuntu</div>
                </div>
            
                <div id="L60" class="code-line flex group dimmed" data-line="60">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">60</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"> </div>
                </div>
            
                <div id="L61" class="code-line flex group dimmed" data-line="61">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">61</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">AWS_REGION</span><span class="token punctuation">:</span> ap<span class="token punctuation">-</span>south<span class="token punctuation">-</span><span class="token number">1</span></div>
                </div>
            
                <div id="L62" class="code-line flex group dimmed" data-line="62">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">62</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">SECRETS_MANAGER</span><span class="token punctuation">:</span> rag_secrets</div>
                </div>
            
                <div id="L63" class="code-line flex group dimmed" data-line="63">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">63</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">CLOUDWATCH_LOG_GROUP</span><span class="token punctuation">:</span> altgan<span class="token punctuation">-</span>log<span class="token punctuation">-</span>group</div>
                </div>
            
                <div id="L64" class="code-line flex group dimmed" data-line="64">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">64</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">CLOUDWATCH_LOG_STREAM</span><span class="token punctuation">:</span> altgan<span class="token punctuation">-</span>log<span class="token punctuation">-</span>stream</div>
                </div>
            
                <div id="L65" class="code-line flex group dimmed" data-line="65">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">65</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"> </div>
                </div>
            
                <div id="L66" class="code-line flex group dimmed" data-line="66">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">66</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">QDRANT_ENABLE_HYBRID</span><span class="token punctuation">:</span> <span class="token boolean important">True</span></div>
                </div>
            
                <div id="L67" class="code-line flex group dimmed" data-line="67">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">67</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">FASTEMBED_SPARSE_MODEL</span><span class="token punctuation">:</span> Qdrant/bm42<span class="token punctuation">-</span>all<span class="token punctuation">-</span>minilm<span class="token punctuation">-</span>l6<span class="token punctuation">-</span>v2<span class="token punctuation">-</span>attentions</div>
                </div>
            
                <div id="L68" class="code-line flex group dimmed" data-line="68">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">68</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">RAG_SIMILARITY_CUTOFF</span><span class="token punctuation">:</span> <span class="token number">0.1</span></div>
                </div>
            
                <div id="L69" class="code-line flex group dimmed" data-line="69">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">69</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">RAG_SIMILARITY_TOP_K</span><span class="token punctuation">:</span> <span class="token number">20</span></div>
                </div>
            
                <div id="L70" class="code-line flex group dimmed" data-line="70">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">70</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">RAG_RERANKED_TOP_N</span><span class="token punctuation">:</span> <span class="token number">8</span></div>
                </div>
            
                <div id="L71" class="code-line flex group dimmed" data-line="71">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">71</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">RAG_SIMILARITY_TOP_K_REPORT</span><span class="token punctuation">:</span> <span class="token number">20</span></div>
                </div>
            
                <div id="L72" class="code-line flex group dimmed" data-line="72">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">72</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">RAG_RERANKED_TOP_N_REPORT</span><span class="token punctuation">:</span> <span class="token number">8</span></div>
                </div>
            
                <div id="L73" class="code-line flex group dimmed" data-line="73">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">73</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">RAG_CITATION_CHUNK_SIZE</span><span class="token punctuation">:</span> <span class="token number">1024</span></div>
                </div>
            
                <div id="L74" class="code-line flex group dimmed" data-line="74">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">74</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">RAG_CITATION_CHUNK_OVERLAP</span><span class="token punctuation">:</span> <span class="token number">32</span></div>
                </div>
            
                <div id="L75" class="code-line flex group dimmed" data-line="75">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">75</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">RAG_STREAMING</span><span class="token punctuation">:</span> <span class="token boolean important">True</span></div>
                </div>
            
                <div id="L76" class="code-line flex group dimmed" data-line="76">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">76</span>
                    <div class="flex-1 text-slate-300 whitespace-pre"><span class="token key atrule">RAG_SIMILARITY_CUTOFF_CHAT</span><span class="token punctuation">:</span> <span class="token number">0.3</span></div>
                </div>
            </div>
        </div>
    </section>
</main>

<script>
    const CODE_FILE = `HF_EMBED: mixedbread-ai/mxbai-embed-large-v1
COHERE_RERANKER: rerank-v3.5
LLM_MODEL_TYPE: OPENROUTER
PROMPT_DIR: prompts

# Local Storage Configuration
LOCAL_PERSIST_DIR: data/persist
LOCAL_TEMP_DIR: data/temp
LOCAL_CHAT_HISTORY_DIR: ../data/chat_history

OPENAI:
REPORT:
MODEL_NAME: gpt-4
MAX_TOKENS: 4096
TEMPERATURE: 0.7
TOP_P: 0.8
REQUEST_TIMEOUT: 180.0
CONTEXT_WINDOW: 8192
CHAT:
MODEL_NAME: gpt-4
MAX_TOKENS: 1024
TEMPERATURE: 0.5
TOP_P: 0.7
REQUEST_TIMEOUT: 180.0
CONTEXT_WINDOW: 8192

OPENROUTER:
REPORT:
MODEL_NAME: meta-llama/llama-3-70b-instruct
MAX_TOKENS: 4096
TEMPERATURE: 0.3
TOP_P: 0.7
REQUEST_TIMEOUT: 180.0
CONTEXT_WINDOW: 8192
CHAT:
MODEL_NAME: meta-llama/llama-3-70b-instruct
MAX_TOKENS: 2048
TEMPERATURE: 0.6
TOP_P: 0.7
REQUEST_TIMEOUT: 180.0
CONTEXT_WINDOW: 8192

OLLAMA:
REPORT:
MODEL_NAME: llama3.1:8b
CTX_LENGTH: 32768
PREDICT_LENGTH: 4096

ANTHROPIC:
REPORT:
MODEL_NAME: claude-3-opus-latest
CTX_LENGTH: 32768
PREDICT_LENGTH: 4096

PDF_BASE_URL: https://rag-llm.s3.us-east-2.amazonaws.com/
S3_LOGS_BUCKET: altgan-logs
S3_CHAT_HISTORY: chat_logs
S3_PERSIST_BUCKET: altgan-persist
S3_PERSIST_DIR: /home/ubuntu

AWS_REGION: ap-south-1
SECRETS_MANAGER: rag_secrets
CLOUDWATCH_LOG_GROUP: altgan-log-group
CLOUDWATCH_LOG_STREAM: altgan-log-stream

QDRANT_ENABLE_HYBRID: True
FASTEMBED_SPARSE_MODEL: Qdrant/bm42-all-minilm-l6-v2-attentions
RAG_SIMILARITY_CUTOFF: 0.1
RAG_SIMILARITY_TOP_K: 20
RAG_RERANKED_TOP_N: 8
RAG_SIMILARITY_TOP_K_REPORT: 20
RAG_RERANKED_TOP_N_REPORT: 8
RAG_CITATION_CHUNK_SIZE: 1024
RAG_CITATION_CHUNK_OVERLAP: 32
RAG_STREAMING: True
RAG_SIMILARITY_CUTOFF_CHAT: 0.3`;

    const WALKTHROUGH_JSON = [
        {
            "id": 1,
            "title": "Re-ranking Model Selection",
            "description": "This block defines the external re-ranking model used in the RAG pipeline. By explicitly configuring COHERE_RERANKER, the system opts for a cross-encoder style re-ranker that evaluates queryâ€“document pairs jointly.",
            "codeBlock": "COHERE_RERANKER: rerank-v3.5",
            "label": "Re-ranking Model Load",
            "lineRange": [2, 2]
        },
        {
            "id": 2,
            "title": "Candidate Pool Size",
            "description": "These configurations control how many candidates are passed from the retriever stage. They define the breadth of recall before re-ranking.",
            "codeBlock": "RAG_SIMILARITY_TOP_K: 20\nRAG_SIMILARITY_TOP_K_REPORT: 20",
            "label": "Candidate Selection",
            "lineRange": [66, 68]
        },
        {
            "id": 3,
            "title": "Re-ranked Output Truncation",
            "description": "These parameters define how many documents survive after re-ranking scores are applied. This caps the final ranked list sent to the generator.",
            "codeBlock": "RAG_RERANKED_TOP_N: 8\nRAG_RERANKED_TOP_N_REPORT: 8",
            "label": "Ranking Strategy",
            "lineRange": [67, 69]
        },
        {
            "id": 4,
            "title": "Similarity Cutoff",
            "description": "Acts as a coarse pre-filter. Removes clearly irrelevant chunks early, reducing the load on the re-ranker and optimizing latency.",
            "codeBlock": "RAG_SIMILARITY_CUTOFF: 0.1\nRAG_SIMILARITY_CUTOFF_CHAT: 0.3",
            "label": "Candidate Filtering",
            "lineRange": [65, 73]
        },
        {
            "id": 5,
            "title": "Hybrid Retrieval Fusion",
            "description": "Enables sparseâ€“dense fusion. The re-ranker receives candidates from both semantic embeddings and lexical (BM42) signals.",
            "codeBlock": "QDRANT_ENABLE_HYBRID: True\nFASTEMBED_SPARSE_MODEL: Qdrant/bm42-all-minilm...",
            "label": "Input Composition",
            "lineRange": [63, 64]
        },
        {
            "id": 6,
            "title": "Chunking Granularity",
            "description": "Size and overlap determine the semantic density. Smaller chunks improve precision but increase retrieval count.",
            "codeBlock": "RAG_CITATION_CHUNK_SIZE: 1024\nRAG_CITATION_CHUNK_OVERLAP: 32",
            "label": "Granularity",
            "lineRange": [70, 71]
        },
        {
            "id": 7,
            "title": "Streaming Interaction",
            "description": "Influences when results become visible. In streaming mode, re-ranking must finish before token emission begins.",
            "codeBlock": "RAG_STREAMING: True",
            "label": "Production Constraints",
            "lineRange": [72, 72]
        }
    ];

    // --- State Management ---
    let currentActiveId = 1;
    let isFullMode = false;

    // --- DOM Elements ---
    const explanationContainer = document.getElementById('explanation-container');
    const snippetMode = document.getElementById('snippet-mode');
    const fullMode = document.getElementById('full-mode');
    const fullCodeContainer = document.getElementById('full-code-container');
    const snippetContent = document.querySelector('#snippet-content code');
    const snippetLabel = document.getElementById('snippet-label');
    const toggleBtn = document.getElementById('view-mode-toggle');
    const progressBarInner = document.getElementById('progress-bar-inner');
    const topProgressBar = document.getElementById('progress-bar');

    // --- Initialize UI ---
    function init() {
        renderExplanations();
        renderFullCode();
        setActive(1);
        
        toggleBtn.addEventListener('click', () => {
            isFullMode = !isFullMode;
            toggleView();
        });

        // Scroll Syncing for Full Mode
        fullMode.addEventListener('scroll', throttle(handleScrollSync, 100));
    }

    function renderExplanations() {
        explanationContainer.innerHTML = WALKTHROUGH_JSON.map(step => `
            <div class="explanation-card bg-white p-6 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition-all group" 
                 data-id="${step.id}" 
                 onclick="setActive(${step.id})">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-[10px] font-bold tracking-widest text-indigo-500 uppercase">${step.label}</span>
                    <span class="h-6 w-6 rounded-full bg-slate-50 flex items-center justify-center text-xs text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-colors">${step.id}</span>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-2">${step.title}</h3>
                <p class="text-slate-600 leading-relaxed text-sm">${step.description}</p>
            </div>
        `).join('');
    }

    function renderFullCode() {
        const lines = CODE_FILE.split('\n');
        fullCodeContainer.innerHTML = lines.map((line, idx) => {
            const lineNum = idx + 1;
            const highlighted = Prism.highlight(line, Prism.languages.yaml, 'yaml');
            return `
                <div id="L${lineNum}" class="code-line flex group dimmed" data-line="${lineNum}">
                    <span class="w-12 text-right pr-4 text-slate-600 select-none text-xs font-mono pt-1">${lineNum}</span>
                    <div class="flex-1 text-slate-300 whitespace-pre">${highlighted || ' '}</div>
                </div>
            `;
        }).join('');
    }

    function setActive(id) {
        currentActiveId = id;
        const data = WALKTHROUGH_JSON.find(s => s.id === id);
        
        // Update Card UI
        document.querySelectorAll('.explanation-card').forEach(c => {
            c.classList.remove('active');
            if (parseInt(c.dataset.id) === id) c.classList.add('active');
        });

        // Update Progress
        const progress = (id / WALKTHROUGH_JSON.length) * 100;
        progressBarInner.style.width = `${progress}%`;
        topProgressBar.style.width = `${progress}%`;

        // Update Code UI
        if (isFullMode) {
            highlightFullCodeRange(data.lineRange);
        } else {
            updateSnippet(data);
        }

        // Scroll explanation card into view if needed
        const card = document.querySelector(`.explanation-card[data-id="${id}"]`);
        if (card) {
            card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    }

    function updateSnippet(data) {
        snippetLabel.innerText = data.label;
        snippetContent.innerHTML = Prism.highlight(data.codeBlock, Prism.languages.yaml, 'yaml');
        // Animate
        snippetContent.parentElement.classList.remove('opacity-0');
    }

    function highlightFullCodeRange(range) {
        const [start, end] = range;
        const lines = document.querySelectorAll('.code-line');
        lines.forEach(line => {
            const ln = parseInt(line.dataset.line);
            if (ln >= start && ln <= end) {
                line.classList.add('active');
                line.classList.remove('dimmed');
            } else {
                line.classList.remove('active');
                line.classList.add('dimmed');
            }
        });

        // Scroll to start
        const targetLine = document.getElementById(`L${start}`);
        if (targetLine) {
            targetLine.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    function toggleView() {
        if (isFullMode) {
            snippetMode.classList.add('hidden');
            fullMode.classList.remove('hidden');
            toggleBtn.innerText = "Switch to Snippet";
            highlightFullCodeRange(WALKTHROUGH_JSON.find(s => s.id === currentActiveId).lineRange);
        } else {
            fullMode.classList.add('hidden');
            snippetMode.classList.remove('hidden');
            toggleBtn.innerText = "Switch to Full Code";
            updateSnippet(WALKTHROUGH_JSON.find(s => s.id === currentActiveId));
        }
    }

    function handleScrollSync() {
        if (!isFullMode) return;
        
        const fullModeRect = fullMode.getBoundingClientRect();
        const center = fullModeRect.top + (fullModeRect.height / 2);
        
        // Find line closest to center
        let closestId = currentActiveId;
        let minDistance = Infinity;

        WALKTHROUGH_JSON.forEach(step => {
            const el = document.getElementById(`L${step.lineRange[0]}`);
            if (el) {
                const rect = el.getBoundingClientRect();
                const dist = Math.abs(rect.top - center);
                if (dist < minDistance) {
                    minDistance = dist;
                    closestId = step.id;
                }
            }
        });

        if (closestId !== currentActiveId) {
            setActive(closestId);
        }
    }

    // --- Utils ---
    function throttle(func, limit) {
        let lastFunc;
        let lastRan;
        return function() {
            const context = this;
            const args = arguments;
            if (!lastRan) {
                func.apply(context, args);
                lastRan = Date.now();
            } else {
                clearTimeout(lastFunc);
                lastFunc = setTimeout(function() {
                    if ((Date.now() - lastRan) >= limit) {
                        func.apply(context, args);
                        lastRan = Date.now();
                    }
                }, limit - (Date.now() - lastRan));
            }
        }
    }

    window.onload = init;
</script>

<!-- Audio-guided walkthrough controller -->
<script>
    (function () {
        if (!window.WALKTHROUGH_JSON || !window.setActive) return;

        const steps = window.WALKTHROUGH_JSON;
        const audio = new Audio();
        audio.preload = 'auto';

        let currentIndex = 0;
        let isUserPaused = true;

        function audioSrcFor(stepId) {
            // card-1.mp3 â€¦ card-N.mp3 (matches step IDs)
            return `card-${stepId}.mp3`;
        }

        function loadTrack(index, play = false) {
            currentIndex = Math.max(0, Math.min(steps.length - 1, index));
            const step = steps[currentIndex];
            audio.src = audioSrcFor(step.id);
            try {
                window.setActive(step.id);
            } catch (e) {
                // ignore if setActive not ready yet
            }
            if (play) {
                playCurrent();
            } else {
                isUserPaused = true;
                updatePlayIcon();
            }
        }

        function playCurrent() {
            isUserPaused = false;
            audio.play().catch(function () {
                isUserPaused = true;
                updatePlayIcon();
            });
            updatePlayIcon();
        }

        function pauseCurrent() {
            isUserPaused = true;
            audio.pause();
            updatePlayIcon();
        }

        function nextTrack() {
            if (currentIndex < steps.length - 1) {
                loadTrack(currentIndex + 1, !isUserPaused);
            } else {
                pauseCurrent();
            }
        }

        function prevTrack() {
            if (currentIndex > 0) {
                loadTrack(currentIndex - 1, !isUserPaused);
            } else {
                loadTrack(0, !isUserPaused);
            }
        }

        // UI
        const bar = document.createElement('div');
        bar.id = 'code-audio-controller';
        bar.style.position = 'fixed';
        bar.style.left = '50%';
        bar.style.transform = 'translateX(-50%)';
        bar.style.bottom = '18px';
        bar.style.zIndex = '40';
        bar.style.background = '#0f172a';
        bar.style.color = '#e5e7eb';
        bar.style.borderRadius = '999px';
        bar.style.padding = '8px 18px';
        bar.style.display = 'flex';
        bar.style.alignItems = 'center';
        bar.style.gap = '10px';
        bar.style.boxShadow = '0 12px 30px rgba(15,23,42,0.55)';
        bar.style.fontFamily = 'system-ui, -apple-system, BlinkMacSystemFont, sans-serif';
        bar.innerHTML = `
            <button id="code-audio-prev" style="background:none;border:none;color:#e5e7eb;cursor:pointer;font-size:14px;">â®</button>
            <button id="code-audio-play" style="width:32px;height:32px;border-radius:999px;border:none;background:#22c55e;color:#022c22;font-weight:900;cursor:pointer;">â–¶</button>
            <button id="code-audio-next" style="background:none;border:none;color:#e5e7eb;cursor:pointer;font-size:14px;">â­</button>
            <div style="min-width:180px;">
                <div id="code-audio-label" style="font-size:11px;text-transform:uppercase;letter-spacing:0.15em;color:#a5b4fc;">Step 1</div>
                <div style="width:100%;height:4px;border-radius:999px;background:#1e293b;overflow:hidden;margin-top:4px;">
                    <div id="code-audio-progress" style="height:100%;width:0%;background:#22c55e;"></div>
                </div>
            </div>
        `;
        document.body.appendChild(bar);

        const playBtn = document.getElementById('code-audio-play');
        const prevBtn = document.getElementById('code-audio-prev');
        const nextBtn = document.getElementById('code-audio-next');
        const label = document.getElementById('code-audio-label');
        const progress = document.getElementById('code-audio-progress');

        function updatePlayIcon() {
            playBtn.textContent = isUserPaused ? 'â–¶' : 'â¸';
        }

        function updateLabel() {
            const step = steps[currentIndex];
            label.textContent = `${step.label || step.title || 'Step'} â€¢ ${currentIndex + 1}/${steps.length}`;
        }

        playBtn.addEventListener('click', function () {
            if (isUserPaused) {
                playCurrent();
            } else {
                pauseCurrent();
            }
        });
        prevBtn.addEventListener('click', prevTrack);
        nextBtn.addEventListener('click', nextTrack);

        audio.addEventListener('timeupdate', function () {
            if (!audio.duration) return;
            const pct = (audio.currentTime / audio.duration) * 100;
            progress.style.width = pct + '%';
        });

        audio.addEventListener('ended', function () {
            nextTrack();
        });

        // Initialize first step without autoplay
        loadTrack(0, false);
        updateLabel();
    })();
</script>

</body></html>